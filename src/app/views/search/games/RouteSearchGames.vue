<script lang="ts">
import { computed } from 'vue';
import { getQuery } from '../../../../utils/router';
import { createAppRoute, defineAppRouteOptions } from '../../../../_common/route/route-component';
import { $gettextInterpolate } from '../../../../_common/translate/translate.service';
import AppGameGrid from '../../../components/game/grid/grid.vue';
import { sendSearch } from '../../../components/search/search-service';
import { useSearchRouteController } from '../RouteSearch.vue';

export default {
	...defineAppRouteOptions({
		cache: true,
		resolver: ({ route }) =>
			sendSearch(getQuery(route, 'q') ?? '', {
				type: 'game',
				page: route.query.page ? parseInt(getQuery(route, 'page')!, 10) : 1,
			}),
	}),
};
</script>

<script lang="ts" setup>
const { processPayload, hasSearch, searchPayload, query } = useSearchRouteController()!;

createAppRoute({
	routeTitle: computed(() =>
		$gettextInterpolate(`"%{ query }" games`, {
			query: query.value,
		})
	),
	onResolved({ payload }) {
		processPayload({ payload });
	},
});
</script>

<template>
	<section class="section">
		<div v-if="hasSearch" class="container-xl">
			<AppGameGrid
				:games="searchPayload.games"
				:games-count="searchPayload.gamesCount"
				:current-page="searchPayload.page"
				show-ads
				event-label="search-games"
			/>
		</div>
	</section>
</template>
